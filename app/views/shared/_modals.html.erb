<%# app/views/layouts/_modals.html.erb %>

<%# Enhanced Modal Component using Alpine.js with Rails integration %>
<div 
  x-data="modalSystem()"
  x-init="init()"
  @keydown.escape.window="closeActiveModal()"
  @open-modal.window="openModal($event.detail)"
  @close-modal.window="closeActiveModal()"
  @open-modal-from-url.window="openModalFromUrl($event.detail)"
  class="relative z-50"
  aria-labelledby="modal-title" 
  role="dialog" 
  aria-modal="true"
>
  <%# Modal container - invisible until a modal is opened %>
  <template x-if="modalStack.length > 0">
    <div>
      <!-- Background backdrop -->
      <div 
        x-show="modalStack.length > 0" 
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="fixed inset-0 bg-gray-900 bg-opacity-75 backdrop-blur-sm transition-opacity"
        @click="backdropClick()"
        x-bind:style="{ 'z-index': 9990 + modalStack.length }"
      ></div>

      <div class="fixed inset-0 z-10 overflow-y-auto" x-bind:style="{ 'z-index': 9991 + modalStack.length }">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
          <!-- Modal panel - rendered for each modal in the stack -->
          <template x-for="(modal, index) in modalStack" :key="modal.id">
            <div 
              x-show="true" 
              x-transition:enter="transition ease-out duration-300"
              x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
              x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
              x-transition:leave="transition ease-in duration-200"
              x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
              x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
              x-bind:class="{
                'sm:max-w-xs': modal.size === 'xs',
                'sm:max-w-sm': modal.size === 'sm',
                'sm:max-w-md': modal.size === 'md',
                'sm:max-w-lg': modal.size === 'lg',
                'sm:max-w-xl': modal.size === 'xl',
                'sm:max-w-2xl': modal.size === '2xl',
                'sm:max-w-3xl': modal.size === '3xl',
                'sm:max-w-4xl': modal.size === '4xl',
                'sm:max-w-5xl': modal.size === '5xl',
                'sm:max-w-6xl': modal.size === '6xl',
                'sm:max-w-7xl': modal.size === '7xl',
                'inline-block': true,
                'visible': index === modalStack.length - 1,
                'invisible': index !== modalStack.length - 1
              }"
              class="relative transform overflow-hidden rounded-xl bg-white text-left shadow-xl transition-all sm:my-8 w-full"
              @click.stop
              x-bind:style="{ 'z-index': 9992 + index }"
              x-ref="modal"
              x-on:click.outside="modal.closeOnClickOutside ? closeModalByIndex(index) : null"
              role="dialog"
              aria-modal="true"
              tabindex="-1"
            >
              <!-- Modal loading overlay -->
              <div 
                x-show="modal.loading" 
                class="absolute inset-0 bg-white bg-opacity-80 flex items-center justify-center z-50"
              >
                <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"></div>
              </div>
              
              <!-- Modal header with gradient bg -->
              <div 
                x-bind:class="{
                  'bg-gradient-to-r from-indigo-600 to-violet-700': modal.type === 'default',
                  'bg-gradient-to-r from-green-500 to-emerald-600': modal.type === 'success',
                  'bg-gradient-to-r from-red-500 to-rose-600': modal.type === 'danger',
                  'bg-gradient-to-r from-amber-500 to-orange-600': modal.type === 'warning',
                  'bg-gradient-to-r from-blue-500 to-indigo-600': modal.type === 'info'
                }" 
                class="px-6 py-4 text-white"
              >
                <div class="flex items-center justify-between">
                  <h3 class="text-lg font-medium leading-6" id="modal-title" x-text="modal.title"></h3>
                  <button 
                    type="button" 
                    class="rounded-md bg-white bg-opacity-20 p-1.5 text-white hover:bg-opacity-30 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-indigo-600" 
                    @click="closeModalByIndex(index)"
                    x-show="modal.showCloseButton !== false"
                  >
                    <span class="sr-only">Close</span>
                    <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>
              </div>
              
              <!-- Modal content -->
              <div 
                x-bind:class="{ 'p-6': modal.padding !== false }"
                x-html="modal.content"
                class="modal-content-container"
              ></div>
              
              <!-- Modal footer -->
              <div 
                x-show="modal.showFooter !== false"
                x-bind:class="{ 'border-t border-gray-200': true, 'pb-safe': isMobile() }"
                class="bg-gray-50 px-6 py-4 flex flex-row-reverse gap-2"
              >
                <template x-if="modal.confirmAction !== null">
                  <button 
                    type="button" 
                    x-bind:class="{
                      'bg-indigo-600 hover:bg-indigo-700 focus:ring-indigo-500': modal.type === 'default',
                      'bg-green-600 hover:bg-green-700 focus:ring-green-500': modal.type === 'success',
                      'bg-red-600 hover:bg-red-700 focus:ring-red-500': modal.type === 'danger',
                      'bg-amber-600 hover:bg-amber-700 focus:ring-amber-500': modal.type === 'warning',
                      'bg-blue-600 hover:bg-blue-700 focus:ring-blue-500': modal.type === 'info',
                      'opacity-50 cursor-not-allowed': modal.confirmDisabled === true
                    }"
                    x-bind:disabled="modal.confirmDisabled === true"
                    class="inline-flex justify-center rounded-md border border-transparent px-4 py-2 text-sm font-medium text-white shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2"
                    @click="handleConfirmAction(index)"
                    x-text="modal.confirmText || 'Confirm'"
                  ></button>
                </template>
                
                <button 
                  type="button" 
                  class="inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
                  @click="closeModalByIndex(index)"
                  x-text="modal.cancelText || 'Cancel'"
                ></button>
              </div>
            </div>
          </template>
        </div>
      </div>
    </div>
  </template>
</div>

<%# Helper JavaScript for modal functionality %>
<script>
  document.addEventListener('alpine:init', () => {
    Alpine.data('modalSystem', () => ({
      modalStack: [],
      modalCounter: 0,
      
      init() {
        // Handle form submissions inside modals
        document.addEventListener('submit', (e) => {
          if (e.target.closest('.modal-content-container') && e.target.getAttribute('data-remote') === 'true') {
            e.preventDefault();
            this.handleFormSubmit(e.target);
          }
        });
        
        // Handle special link clicks inside modals
        document.addEventListener('click', (e) => {
          const link = e.target.closest('a[data-modal-url]');
          if (link && link.closest('.modal-content-container')) {
            e.preventDefault();
            
            const url = link.getAttribute('data-modal-url');
            const title = link.getAttribute('data-modal-title') || 'Loading...';
            const size = link.getAttribute('data-modal-size') || 'md';
            const type = link.getAttribute('data-modal-type') || 'default';
            
            this.openModalFromUrl({
              url: url,
              title: title,
              size: size,
              type: type
            });
          }
        });
      },
      
      openModal(options) {
        this.modalCounter++;
        const modalId = `modal-${this.modalCounter}`;
        
        // Default modal options
        const defaultOptions = {
          id: modalId,
          title: '',
          content: '',
          size: 'md',
          type: 'default',
          confirmAction: null,
          confirmText: 'Confirm',
          cancelText: 'Cancel',
          showFooter: true,
          showCloseButton: true,
          closeOnClickOutside: true,
          loading: false,
          padding: true
        };
        
        // Merge options with defaults
        const modalOptions = { ...defaultOptions, ...options };
        
        // Add CSRF token to content if it has a form
        if (modalOptions.content && modalOptions.content.includes('<form') && !modalOptions.content.includes('csrf-token')) {
          const csrfToken = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content');
          if (csrfToken) {
            modalOptions.content = modalOptions.content.replace('<form', `<form data-modal-form="true"><input type="hidden" name="authenticity_token" value="${csrfToken}">`)
          }
        }
        
        // Add to modal stack
        this.modalStack.push(modalOptions);
        
        // Lock body scroll
        document.body.classList.add('overflow-hidden');
        
        // Execute onOpen callback if provided
        if (typeof modalOptions.onOpen === 'function') {
          setTimeout(() => {
            modalOptions.onOpen(modalOptions);
          }, 100);
        }
      },
      
      closeActiveModal() {
        if (this.modalStack.length > 0) {
          const modal = this.modalStack[this.modalStack.length - 1];
          
          // Execute onClose callback if provided
          if (typeof modal.onClose === 'function') {
            modal.onClose(modal);
          }
          
          // Remove from stack
          this.modalStack.pop();
          
          // Unlock body scroll if no modals left
          if (this.modalStack.length === 0) {
            document.body.classList.remove('overflow-hidden');
          }
        }
      },
      
      closeModalByIndex(index) {
        if (index >= 0 && index < this.modalStack.length) {
          const modal = this.modalStack[index];
          
          // Execute onClose callback if provided
          if (typeof modal.onClose === 'function') {
            modal.onClose(modal);
          }
          
          // Remove modal at index
          this.modalStack.splice(index, 1);
          
          // Unlock body scroll if no modals left
          if (this.modalStack.length === 0) {
            document.body.classList.remove('overflow-hidden');
          }
        }
      },
      
      backdropClick() {
        if (this.modalStack.length > 0) {
          const lastModal = this.modalStack[this.modalStack.length - 1];
          if (lastModal.closeOnClickOutside) {
            this.closeActiveModal();
          }
        }
      },
      
      handleConfirmAction(index) {
        if (index >= 0 && index < this.modalStack.length) {
          const modal = this.modalStack[index];
          if (typeof modal.confirmAction === 'function') {
            // Execute the confirm action and capture the result
            const result = modal.confirmAction(modal);
            
            // Close the modal if the result is not explicitly false
            if (result !== false) {
              this.closeModalByIndex(index);
            }
          } else {
            this.closeModalByIndex(index);
          }
        }
      },
      
      openModalFromUrl(options) {
        if (!options.url) return;
        
        // Create an initial loading modal
        this.openModal({
          title: options.title || 'Loading...',
          content: '<div class="py-12 flex justify-center items-center"><div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"></div></div>',
          size: options.size || 'md',
          type: options.type || 'default',
          showFooter: false,
          padding: true
        });
        
        // Get current modal index
        const modalIndex = this.modalStack.length - 1;
        
        // Fetch content from URL
        fetch(options.url, {
          headers: {
            'X-Requested-With': 'XMLHttpRequest',
            'Accept': 'text/html, application/xhtml+xml'
          },
          credentials: 'same-origin'
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.text();
        })
        .then(content => {
          // Update the modal with fetched content
          if (modalIndex >= 0 && modalIndex < this.modalStack.length) {
            this.modalStack[modalIndex].content = content;
            this.modalStack[modalIndex].title = options.title || this.modalStack[modalIndex].title;
            this.modalStack[modalIndex].showFooter = options.showFooter !== undefined ? options.showFooter : true;
            this.modalStack[modalIndex].confirmText = options.confirmText || this.modalStack[modalIndex].confirmText;
            this.modalStack[modalIndex].confirmAction = options.confirmAction || null;
          }
        })
        .catch(error => {
          // Show error in modal
          if (modalIndex >= 0 && modalIndex < this.modalStack.length) {
            this.modalStack[modalIndex].content = `<div class="text-center py-6"><div class="rounded-full bg-red-100 p-3 mx-auto w-16 h-16 flex items-center justify-center mb-4"><svg class="w-8 h-8 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></div><h3 class="text-lg font-medium text-gray-900 mb-2">Error Loading Content</h3><p class="text-gray-500">${error.message}</p></div>`;
            this.modalStack[modalIndex].title = 'Error';
            this.modalStack[modalIndex].type = 'danger';
            this.modalStack[modalIndex].showFooter = true;
          }
        });
      },
      
      handleFormSubmit(form) {
        if (!form) return;
        
        // Get current modal index
        const modalIndex = this.modalStack.length - 1;
        if (modalIndex < 0) return;
        
        // Show loading state
        this.modalStack[modalIndex].loading = true;
        
        // Gather form data
        const formData = new FormData(form);
        const url = form.getAttribute('action') || window.location.href;
        const method = (form.getAttribute('method') || 'POST').toUpperCase();
        
        // Send form data
        fetch(url, {
          method: method,
          headers: {
            'X-Requested-With': 'XMLHttpRequest',
            'Accept': 'text/html, application/xhtml+xml, application/json'
          },
          body: formData,
          credentials: 'same-origin'
        })
        .then(response => {
          const contentType = response.headers.get('Content-Type') || '';
          
          if (contentType.includes('application/json')) {
            return response.json().then(data => ({
              data: data,
              isJson: true,
              status: response.status
            }));
          } else {
            return response.text().then(text => ({
              data: text,
              isJson: false,
              status: response.status
            }));
          }
        })
        .then(({ data, isJson, status }) => {
          // Hide loading state
          if (modalIndex >= 0 && modalIndex < this.modalStack.length) {
            this.modalStack[modalIndex].loading = false;
          }
          
          if (status >= 200 && status < 300) {
            // Success response
            if (isJson) {
              // Handle JSON response
              if (data.redirect) {
                // Redirect if specified
                window.location.href = data.redirect;
              } else if (data.modal) {
                // Update modal content if provided
                if (modalIndex >= 0 && modalIndex < this.modalStack.length) {
                  this.modalStack[modalIndex].content = data.modal.content || this.modalStack[modalIndex].content;
                  this.modalStack[modalIndex].title = data.modal.title || this.modalStack[modalIndex].title;
                  this.modalStack[modalIndex].showFooter = data.modal.showFooter !== undefined ? data.modal.showFooter : this.modalStack[modalIndex].showFooter;
                }
              } else if (data.refresh) {
                // Refresh the page if requested
                window.location.reload();
              } else if (data.success) {
                // Show success message
                this.showNotification(data.message || 'Operation completed successfully', 'success');
                this.closeActiveModal();
              }
            } else {
              // Update modal with HTML response
              if (modalIndex >= 0 && modalIndex < this.modalStack.length) {
                this.modalStack[modalIndex].content = data;
              }
            }
          } else {
            // Error response
            if (isJson && data.errors) {
              // Show validation errors in the form
              const modalContent = document.querySelector('.modal-content-container');
              if (modalContent) {
                Object.keys(data.errors).forEach(field => {
                  const inputElement = modalContent.querySelector(`[name="${field}"], [name="${field}[]"]`);
                  if (inputElement) {
                    inputElement.classList.add('border-red-500');
                    
                    // Add error message
                    const errorMsg = document.createElement('p');
                    errorMsg.className = 'text-red-500 text-xs mt-1';
                    errorMsg.textContent = data.errors[field][0];
                    
                    // Remove any existing error messages
                    const existingError = inputElement.parentNode.querySelector('.text-red-500');
                    if (existingError) {
                      existingError.remove();
                    }
                    
                    // Insert the error message after the input
                    inputElement.parentNode.insertBefore(errorMsg, inputElement.nextSibling);
                  }
                });
              }
            } else {
              // Show general error message
              this.showNotification('An error occurred. Please try again.', 'error');
            }
          }
        })
        .catch(error => {
          // Hide loading state
          if (modalIndex >= 0 && modalIndex < this.modalStack.length) {
            this.modalStack[modalIndex].loading = false;
          }
          
          // Show error notification
          this.showNotification('An error occurred: ' + error.message, 'error');
        });
      },
      
      showNotification(message, type = 'info') {
        // Simple notification system
        // Create notification element
        const notification = document.createElement('div');
        notification.className = `fixed bottom-4 right-4 p-4 rounded-lg shadow-lg text-white ${
          type === 'success' ? 'bg-green-600' : 
          type === 'error' ? 'bg-red-600' : 
          type === 'warning' ? 'bg-amber-600' : 'bg-indigo-600'
        } transform transition-all duration-300 translate-y-20 opacity-0 z-[9999]`;
        notification.innerHTML = message;
        
        // Add to document
        document.body.appendChild(notification);
        
        // Animate in
        setTimeout(() => {
          notification.classList.remove('translate-y-20', 'opacity-0');
          notification.classList.add('translate-y-0', 'opacity-100');
        }, 10);
        
        // Animate out and remove after delay
        setTimeout(() => {
          notification.classList.add('translate-y-20', 'opacity-0');
          
          // Remove from DOM after animation completes
          setTimeout(() => {
            notification.remove();
          }, 300);
        }, 5000);
      },
      
      isMobile() {
        return window.innerWidth < 640;
      }
    }));
  });
  
  // Helper function to open modals from anywhere
  window.openModal = function(options) {
    window.dispatchEvent(new CustomEvent('open-modal', { 
      detail: options
    }));
  };
  
  // Helper function to close the active modal
  window.closeModal = function() {
    window.dispatchEvent(new CustomEvent('close-modal'));
  };
  
  // Helper function to open modals from URLs
  window.openModalFromUrl = function(options) {
    window.dispatchEvent(new CustomEvent('open-modal-from-url', { 
      detail: options
    }));
  };
  
  // Set up data-* attributes for modal triggers
  document.addEventListener('DOMContentLoaded', function() {
    // Handle elements with data-modal-trigger attribute
    document.querySelectorAll('[data-modal-trigger]').forEach(element => {
      element.addEventListener('click', function(e) {
        e.preventDefault();
        
        const targetId = this.getAttribute('data-modal-trigger');
        let target = document.getElementById(targetId);
        
        // If the target is a template, use its content
        if (target && target.tagName === 'TEMPLATE') {
          openModal({
            title: this.getAttribute('data-modal-title') || '',
            content: target.innerHTML,
            size: this.getAttribute('data-modal-size') || 'md',
            type: this.getAttribute('data-modal-type') || 'default',
            confirmText: this.getAttribute('data-modal-confirm-text') || 'Confirm',
            cancelText: this.getAttribute('data-modal-cancel-text') || 'Cancel',
            showFooter: this.getAttribute('data-modal-footer') !== 'false',
            closeOnClickOutside: this.getAttribute('data-modal-close-on-click-outside') !== 'false',
            confirmAction: this.hasAttribute('data-modal-confirm-action') ? 
              new Function(this.getAttribute('data-modal-confirm-action')) : null
          });
        }
      });
    });
    
    // Handle elements with data-modal-url attribute
    document.querySelectorAll('[data-modal-url]').forEach(element => {
      element.addEventListener('click', function(e) {
        e.preventDefault();
        
        openModalFromUrl({
          url: this.getAttribute('data-modal-url'),
          title: this.getAttribute('data-modal-title') || 'Loading...',
          size: this.getAttribute('data-modal-size') || 'md',
          type: this.getAttribute('data-modal-type') || 'default',
          showFooter: this.getAttribute('data-modal-footer') !== 'false'
        });
      });
    });
  });
</script>

<%# Modal Templates %>
<template id="login-modal-template">
  <div class="space-y-6" id="login-form-container">
    <p class="text-gray-600">Sign in to your Digital Store account to access your dashboard, manage products, and view your orders.</p>
    
    <form id="login-form" data-remote="true" class="space-y-4">
      <div>
        <label for="modal-email" class="block text-sm font-medium text-gray-700">Email</label>
        <input type="email" id="modal-email" name="user[email]" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="your@email.com" required>
      </div>
      
      <div>
        <label for="modal-password" class="block text-sm font-medium text-gray-700">Password</label>
        <input type="password" id="modal-password" name="user[password]" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required>
      </div>
      
      <div class="flex items-center justify-between">
        <div class="flex items-center">
          <input id="modal-remember-me" name="user[remember_me]" type="checkbox" value="1" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
          <label for="modal-remember-me" class="ml-2 block text-sm text-gray-700">Remember me</label>
        </div>
        
        <a href="#" class="text-sm font-medium text-indigo-600 hover:text-indigo-500">Forgot password?</a>
      </div>
    </form>
    
    <div class="pt-2">
      <div class="relative">
        <div class="absolute inset-0 flex items-center">
          <div class="w-full border-t border-gray-300"></div>
        </div>
        <div class="relative flex justify-center text-sm">
          <span class="bg-white px-2 text-gray-500">Or continue with</span>
        </div>
      </div>
      
      <div class="mt-4 grid grid-cols-2 gap-3">
        <button type="button" class="inline-flex w-full justify-center rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-500 shadow-sm hover:bg-gray-50">
          <svg class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 2C6.477 2 2 6.477 2 12c0 4.418 2.865 8.166 6.839 9.489.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.605-3.369-1.343-3.369-1.343-.454-1.155-1.11-1.462-1.11-1.462-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12c0-5.523-4.477-10-10-10z" />
          </svg>
          Google
        </button>
        <button type="button" class="inline-flex w-full justify-center rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-500 shadow-sm hover:bg-gray-50">
          <svg class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" />
          </svg>
          Facebook
        </button>
      </div>
    </div>

    <div class="text-center text-sm text-gray-600 border-t border-gray-200 pt-4 mt-6">
      Don't have an account? 
      <a href="#" class="font-medium text-indigo-600 hover:text-indigo-500" data-modal-trigger="signup-modal-template" data-modal-title="Create Account">
        Sign up now
      </a>
    </div>
  </div>
</template>

<template id="signup-modal-template">
  <div class="space-y-6">
    <p class="text-gray-600">Create your Digital Store account to start selling or purchasing digital and physical products.</p>
    
    <form id="signup-form" data-remote="true" class="space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label for="signup-first-name" class="block text-sm font-medium text-gray-700">First Name</label>
          <input type="text" id="signup-first-name" name="user[first_name]" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required>
        </div>
        
        <div>
          <label for="signup-last-name" class="block text-sm font-medium text-gray-700">Last Name</label>
          <input type="text" id="signup-last-name" name="user[last_name]" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required>
        </div>
      </div>
      
      <div>
        <label for="signup-email" class="block text-sm font-medium text-gray-700">Email</label>
        <input type="email" id="signup-email" name="user[email]" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="your@email.com" required>
      </div>
      
      <div>
        <label for="signup-password" class="block text-sm font-medium text-gray-700">Password</label>
        <input type="password" id="signup-password" name="user[password]" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required>
        <p class="text-xs text-gray-500 mt-1">Password must be at least 8 characters and include a number and a symbol</p>
      </div>
      
      <div>
        <label for="signup-password-confirmation" class="block text-sm font-medium text-gray-700">Confirm Password</label>
        <input type="password" id="signup-password-confirmation" name="user[password_confirmation]" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required>
      </div>
      
      <div class="flex items-center">
        <input id="signup-terms" name="user[terms_accepted]" type="checkbox" value="1" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" required>
        <label for="signup-terms" class="ml-2 block text-sm text-gray-700">
          I agree to the <a href="#" class="text-indigo-600 hover:text-indigo-500">Terms of Service</a> and <a href="#" class="text-indigo-600 hover:text-indigo-500">Privacy Policy</a>
        </label>
      </div>
    </form>
    
    <div class="pt-2">
      <div class="relative">
        <div class="absolute inset-0 flex items-center">
          <div class="w-full border-t border-gray-300"></div>
        </div>
        <div class="relative flex justify-center text-sm">
          <span class="bg-white px-2 text-gray-500">Or sign up with</span>
        </div>
      </div>
      
      <div class="mt-4 grid grid-cols-2 gap-3">
        <button type="button" class="inline-flex w-full justify-center rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-500 shadow-sm hover:bg-gray-50">
          <svg class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 2C6.477 2 2 6.477 2 12c0 4.418 2.865 8.166 6.839 9.489.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.605-3.369-1.343-3.369-1.343-.454-1.155-1.11-1.462-1.11-1.462-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12c0-5.523-4.477-10-10-10z" />
          </svg>
          Google
        </button>
        <button type="button" class="inline-flex w-full justify-center rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-500 shadow-sm hover:bg-gray-50">
          <svg class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" />
          </svg>
          Facebook
        </button>
      </div>
    </div>

    <div class="text-center text-sm text-gray-600 border-t border-gray-200 pt-4 mt-6">
      Already have an account? 
      <a href="#" class="font-medium text-indigo-600 hover:text-indigo-500" data-modal-trigger="login-modal-template" data-modal-title="Sign In">
        Sign in
      </a>
    </div>
  </div>
</template>

<template id="quick-view-product-template">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="bg-gradient-to-br from-indigo-100 to-purple-100 rounded-lg p-4 flex items-center justify-center">
      <img src="/api/placeholder/400/400" alt="Product image" class="max-h-64 object-contain">
    </div>
    
    <div class="space-y-4">
      <h4 class="text-xl font-bold text-gray-900">Digital Marketing Guide</h4>
      <div class="flex items-center">
        <div class="flex items-center">
          <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
          </svg>
          <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
          </svg>
          <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
          </svg>
          <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
          </svg>
          <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
          </svg>
        </div>
        <span class="text-sm text-gray-500 ml-2">(42 reviews)</span>
      </div>
      
      <div class="flex items-center justify-between">
        <div>
          <p class="text-2xl font-bold text-gray-900">$29.99</p>
          <p class="text-sm text-gray-500">Digital Download (PDF, 120 pages)</p>
        </div>
        <span class="inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800">
          In Stock
        </span>
      </div>
      
      <p class="text-gray-600">Complete guide to digital marketing strategies for beginners and intermediates. Learn SEO, social media marketing, email campaigns, and more.</p>
      
      <div class="pt-2">
        <button type="button" class="w-full bg-indigo-600 border border-transparent rounded-md py-3 px-8 flex items-center justify-center text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
          Add to Cart
        </button>
      </div>
    </div>
  </div>
</template>

<template id="newsletter-modal-template">
  <div class="text-center space-y-4">
    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-indigo-100">
      <svg class="h-8 w-8 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
      </svg>
    </div>
    <h3 class="text-lg font-medium text-gray-900">Subscribe to our newsletter</h3>
    <p class="text-gray-600">Get the latest news, exclusive offers, and product updates delivered to your inbox.</p>
    
    <form id="newsletter-form" data-remote="true" class="mt-4">
      <div class="mt-1">
        <input type="email" id="newsletter-email" name="newsletter[email]" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="your@email.com" required>
      </div>
      
      <div class="mt-4 flex items-start">
        <div class="flex items-center h-5">
          <input id="newsletter-offers" name="newsletter[offers]" type="checkbox" value="1" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
        </div>
        <div class="ml-3 text-sm">
          <label for="newsletter-offers" class="font-medium text-gray-700">Send me special offers</label>
          <p class="text-gray-500">I'd like to receive promotions, sales, and discounts.</p>
        </div>
      </div>
    </form>
  </div>
</template>

<template id="contact-modal-template">
  <div class="space-y-4">
    <p class="text-gray-600">How can we help you today? Please describe your issue and our team will get back to you as soon as possible.</p>
    
    <form id="contact-form" data-remote="true" class="space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label for="contact-name" class="block text-sm font-medium text-gray-700">Name</label>
          <input type="text" id="contact-name" name="contact[name]" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required>
        </div>
        
        <div>
          <label for="contact-email" class="block text-sm font-medium text-gray-700">Email</label>
          <input type="email" id="contact-email" name="contact[email]" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required>
        </div>
      </div>
      
      <div>
        <label for="contact-subject" class="block text-sm font-medium text-gray-700">Subject</label>
        <select id="contact-subject" name="contact[subject]" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
          <option value="general">General Inquiry</option>
          <option value="support">Technical Support</option>
          <option value="billing">Billing Question</option>
          <option value="feature">Feature Request</option>
          <option value="feedback">Feedback</option>
        </select>
      </div>
      
      <div>
        <label for="contact-message" class="block text-sm font-medium text-gray-700">Message</label>
        <textarea id="contact-message" name="contact[message]" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required></textarea>
      </div>
      
      <div class="pt-2">
        <div class="flex items-start">
          <div class="flex items-center h-5">
            <input id="contact-copy" name="contact[send_copy]" type="checkbox" value="1" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
          </div>
          <div class="ml-3 text-sm">
            <label for="contact-copy" class="font-medium text-gray-700">Send me a copy of this message</label>
          </div>
        </div>
      </div>
    </form>
  </div>
</template>

<template id="success-alert-template">
  <div class="text-center py-6">
    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-4">
      <svg class="h-10 w-10 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
      </svg>
    </div>
    <h3 class="text-xl font-medium text-gray-900 mb-2">Success!</h3>
    <p class="text-gray-600">Your action has been completed successfully.</p>
  </div>
</template>

<template id="error-alert-template">
  <div class="text-center py-6">
    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-100 mb-4">
      <svg class="h-10 w-10 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
      </svg>
    </div>
    <h3 class="text-xl font-medium text-gray-900 mb-2">Oops! Something went wrong</h3>
    <p class="text-gray-600">Please try again or contact support if the problem persists.</p>
  </div>
</template>

<template id="confirmation-template">
  <div class="text-center py-6">
    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-yellow-100 mb-4">
      <svg class="h-10 w-10 text-yellow-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
      </svg>
    </div>
    <h3 class="text-xl font-medium text-gray-900 mb-2">Are you sure?</h3>
    <p class="text-gray-600">This action cannot be undone.</p>
  </div>
</template>

<template id="image-gallery-template">
  <div class="image-gallery-modal">
    <div class="flex flex-col md:flex-row md:space-x-6">
      <!-- Image thumbnails sidebar -->
      <div class="md:w-24 mb-4 md:mb-0 flex md:flex-col space-x-2 md:space-x-0 md:space-y-2 overflow-x-auto md:overflow-y-auto">
        <button class="w-20 h-20 rounded-md bg-gray-100 flex-shrink-0 overflow-hidden border-2 border-indigo-500 focus:outline-none">
          <img src="/api/placeholder/200/200?text=1" alt="Product image 1" class="w-full h-full object-cover">
        </button>
        <button class="w-20 h-20 rounded-md bg-gray-100 flex-shrink-0 overflow-hidden border-2 border-transparent hover:border-indigo-300 focus:outline-none focus:border-indigo-500">
          <img src="/api/placeholder/200/200?text=2" alt="Product image 2" class="w-full h-full object-cover">
        </button>
        <button class="w-20 h-20 rounded-md bg-gray-100 flex-shrink-0 overflow-hidden border-2 border-transparent hover:border-indigo-300 focus:outline-none focus:border-indigo-500">
          <img src="/api/placeholder/200/200?text=3" alt="Product image 3" class="w-full h-full object-cover">
        </button>
        <button class="w-20 h-20 rounded-md bg-gray-100 flex-shrink-0 overflow-hidden border-2 border-transparent hover:border-indigo-300 focus:outline-none focus:border-indigo-500">
          <img src="/api/placeholder/200/200?text=4" alt="Product image 4" class="w-full h-full object-cover">
        </button>
      </div>
      
      <!-- Main image display -->
      <div class="flex-grow">
        <div class="bg-gray-100 rounded-lg flex items-center justify-center h-80 md:h-96 relative">
          <img src="/api/placeholder/800/800?text=1" alt="Product image 1" class="max-h-full max-w-full p-4 object-contain">
          
          <!-- Navigation arrows -->
          <button class="absolute left-2 bg-white rounded-full p-2 shadow-md text-gray-700 hover:text-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
          </button>
          
          <button class="absolute right-2 bg-white rounded-full p-2 shadow-md text-gray-700 hover:text-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </button>
        </div>
        
        <!-- Image caption -->
        <div class="mt-2 text-center">
          <p class="text-sm text-gray-500">Image 1 of 4: Front view of product</p>
        </div>
      </div>
    </div>
  </div>
</template>
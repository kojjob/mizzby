<%# app/views/products/_filters_sidebar.html.erb %>
<div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden" data-controller="filter-panel">
  <div class="p-5 border-b border-gray-100">
    <h3 class="font-semibold text-gray-900 flex items-center gap-2">
      <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/></svg>
      Filters
    </h3>
  </div>

  <div class="p-5 space-y-8">
    <%# Categories %>
    <div>
      <h4 class="text-sm font-medium text-gray-900 mb-3 uppercase tracking-wider">Categories</h4>
      <div class="space-y-2 max-h-60 overflow-y-auto scrollbar-thin pr-2">
        <% Category.where(visible: true).order(:name).each do |category| %>
          <label class="flex items-center group cursor-pointer">
            <%= check_box_tag "category_ids[]", category.id,
                params[:category_ids]&.include?(category.id.to_s),
                class: "w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 transition-colors",
                data: { action: "change->filter-panel#submit" } %>
            <span class="ml-3 text-sm text-gray-600 group-hover:text-gray-900 transition-colors flex-1"><%= category.name %></span>
            <span class="text-xs text-gray-400 bg-gray-50 px-2 py-0.5 rounded-full"><%= category.products_count %></span>
          </label>
        <% end %>
      </div>
    </div>

    <%# Price Range %>
    <div>
      <h4 class="text-sm font-medium text-gray-900 mb-4 uppercase tracking-wider">Price Range</h4>
      <div class="space-y-4"
           data-controller="price-range"
           data-price-range-min-value="0"
           data-price-range-max-value="1000"
           data-price-range-current-min-value="<%= params[:min_price] || 0 %>"
           data-price-range-current-max-value="<%= params[:max_price] || 1000 %>">
        
        <div class="relative h-1.5 bg-gray-100 rounded-full">
          <div class="absolute h-full bg-indigo-600 rounded-full" data-price-range-target="track"></div>
          
          <input type="range" min="0" max="1000" value="<%= params[:min_price] || 0 %>"
                 class="absolute w-full h-full opacity-0 cursor-pointer z-20"
                 data-price-range-target="minInput"
                 data-action="input->price-range#updateMinThumb change->filter-panel#submit">
                 
          <input type="range" min="0" max="1000" value="<%= params[:max_price] || 1000 %>"
                 class="absolute w-full h-full opacity-0 cursor-pointer z-20"
                 data-price-range-target="maxInput"
                 data-action="input->price-range#updateMaxThumb change->filter-panel#submit">
                 
          <div class="absolute w-4 h-4 bg-white border-2 border-indigo-600 rounded-full shadow-sm top-1/2 -translate-y-1/2 z-10 pointer-events-none transition-transform hover:scale-110" data-price-range-target="minThumb"></div>
          <div class="absolute w-4 h-4 bg-white border-2 border-indigo-600 rounded-full shadow-sm top-1/2 -translate-y-1/2 z-10 pointer-events-none transition-transform hover:scale-110" data-price-range-target="maxThumb"></div>
        </div>

        <div class="flex items-center justify-between gap-4">
          <div class="relative flex-1">
            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs">$</span>
            <input type="number" name="min_price" 
                   value="<%= params[:min_price] %>" 
                   placeholder="0"
                   class="w-full pl-6 pr-2 py-1.5 text-sm border border-gray-200 rounded-lg focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500"
                   data-price-range-target="minNumberInput"
                   data-action="change->filter-panel#submit">
          </div>
          <span class="text-gray-400">-</span>
          <div class="relative flex-1">
            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs">$</span>
            <input type="number" name="max_price" 
                   value="<%= params[:max_price] %>" 
                   placeholder="1000"
                   class="w-full pl-6 pr-2 py-1.5 text-sm border border-gray-200 rounded-lg focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500"
                   data-price-range-target="maxNumberInput"
                   data-action="change->filter-panel#submit">
          </div>
        </div>
      </div>
    </div>

    <%# Product Type %>
    <div>
      <h4 class="text-sm font-medium text-gray-900 mb-3 uppercase tracking-wider">Product Type</h4>
      <div class="space-y-2">
        <label class="flex items-center group cursor-pointer">
          <%= check_box_tag "digital", "1", params[:digital] == "1",
              class: "w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 transition-colors",
              data: { action: "change->filter-panel#submit" } %>
          <span class="ml-3 text-sm text-gray-600 group-hover:text-gray-900 transition-colors">Digital Products</span>
        </label>
        <label class="flex items-center group cursor-pointer">
          <%= check_box_tag "on_sale", "1", params[:on_sale] == "1",
              class: "w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 transition-colors",
              data: { action: "change->filter-panel#submit" } %>
          <span class="ml-3 text-sm text-gray-600 group-hover:text-gray-900 transition-colors">On Sale</span>
        </label>
        <label class="flex items-center group cursor-pointer">
          <%= check_box_tag "featured", "1", params[:featured] == "1",
              class: "w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 transition-colors",
              data: { action: "change->filter-panel#submit" } %>
          <span class="ml-3 text-sm text-gray-600 group-hover:text-gray-900 transition-colors">Featured</span>
        </label>
      </div>
    </div>
  </div>

  <div class="p-5 border-t border-gray-100 bg-gray-50">
    <%= link_to "Reset Filters", products_path, class: "block w-full py-2 px-4 bg-white border border-gray-200 rounded-lg text-sm font-medium text-gray-600 text-center hover:bg-gray-50 hover:text-gray-900 transition-colors shadow-sm" %>
  </div>
</div>
<%# app/views/products/index.html.erb %>

<div class="min-h-screen bg-gradient-to-br from-slate-50 via-white to-indigo-50">
  <%# Elegant Hero Section %>
  <% hero_products = Product.featured.limit(3) %>
  <% if hero_products.any? %>
    <section
      class="relative overflow-hidden"
      data-controller="hero-carousel"
      data-hero-carousel-autoplay-value="true"
      data-hero-carousel-interval-value="5000">

      <div class="relative h-[50vh] md:h-[60vh]" data-hero-carousel-target="container">
        <% hero_products.each_with_index do |product, index| %>
          <div
            class="absolute inset-0 w-full h-full transition-opacity duration-700 ease-in-out <%= index == 0 ? 'opacity-100' : 'opacity-0' %>"
            data-hero-carousel-target="slide">
            <div class="absolute inset-0 bg-gradient-to-r from-gray-900/80 via-gray-900/60 to-transparent z-10"></div>
            <% if product.product_images.any? && product.product_images.first.image.attached? %>
              <%= image_tag rails_blob_url(product.product_images.first.image), class: "w-full h-full object-cover" %>
            <% else %>
              <div class="w-full h-full bg-gradient-to-br from-indigo-600 to-purple-700"></div>
            <% end %>

            <div class="absolute inset-0 z-20 flex items-center">
              <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 w-full">
                <div class="max-w-lg">
                  <span class="inline-block py-1.5 px-4 rounded-full bg-white/20 backdrop-blur-sm text-white text-sm font-medium mb-4">
                    <%= product.category&.name || 'Featured' %>
                  </span>
                  <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-white leading-tight mb-4">
                    <%= product.name %>
                  </h1>
                  <p class="text-base md:text-lg text-gray-200 mb-6 line-clamp-2">
                    <%= truncate(product.description, length: 100) %>
                  </p>
                  <div class="flex items-center gap-4 mb-6">
                    <% if product.discounted_price.present? && product.discounted_price < product.price %>
                      <span class="text-2xl md:text-3xl font-bold text-white"><%= number_to_currency(product.discounted_price) %></span>
                      <span class="text-lg text-gray-300 line-through"><%= number_to_currency(product.price) %></span>
                      <span class="bg-red-500 text-white text-xs font-bold py-1 px-2 rounded-full">
                        -<%= number_to_percentage(100 - (product.discounted_price / product.price * 100), precision: 0) %>
                      </span>
                    <% else %>
                      <span class="text-2xl md:text-3xl font-bold text-white"><%= number_to_currency(product.price) %></span>
                    <% end %>
                  </div>
                  <div class="flex flex-wrap gap-3">
                    <%= link_to product_path(product), class: "inline-flex items-center gap-2 px-5 py-2.5 bg-white text-gray-900 rounded-xl font-medium hover:bg-gray-100 transition-all shadow-lg" do %>
                      View Product
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
                      </svg>
                    <% end %>
                    <%= button_to add_to_cart_product_path(product), method: :post, class: "inline-flex items-center gap-2 px-5 py-2.5 bg-indigo-600 text-white rounded-xl font-medium hover:bg-indigo-700 transition-all", data: { turbo: true } do %>
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
                      </svg>
                      Add to Cart
                    <% end %>
                  </div>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Navigation Dots -->
      <div class="absolute inset-x-0 bottom-6 z-30 flex justify-center gap-2">
        <% hero_products.each_with_index do |_, index| %>
          <button class="w-2.5 h-2.5 rounded-full transition-all <%= index == 0 ? 'bg-white w-8' : 'bg-white/50' %>"
                  data-hero-carousel-target="indicator"
                  data-action="click->hero-carousel#goToSlide"
                  data-index="<%= index %>"></button>
        <% end %>
      </div>

      <!-- Navigation Arrows -->
      <button class="absolute left-4 top-1/2 -translate-y-1/2 z-30 p-3 rounded-full bg-white/10 backdrop-blur-sm text-white hover:bg-white/20 transition-all"
              data-action="click->hero-carousel#prev">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
      </button>
      <button class="absolute right-4 top-1/2 -translate-y-1/2 z-30 p-3 rounded-full bg-white/10 backdrop-blur-sm text-white hover:bg-white/20 transition-all"
              data-action="click->hero-carousel#next">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </button>
    </section>
  <% end %>

  <%# Category Pills Navigation %>
  <div class="bg-white/80 backdrop-blur-sm shadow-sm sticky top-16 z-20 border-b border-gray-100" data-controller="sticky-nav">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="relative overflow-x-auto scrollbar-hide py-4">
        <div class="flex gap-2" data-sticky-nav-target="container">
          <%= link_to products_path, class: "inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all #{!params[:category_id].present? ? 'bg-indigo-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}" do %>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
            </svg>
            All
          <% end %>
          <% Category.where(visible: true).order(:position).each do |category| %>
            <%= link_to category.name, products_path(category_id: category.id),
                class: "px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all #{params[:category_id].to_i == category.id ? 'bg-indigo-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}" %>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <%# Main Content %>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      
      <%# Elegant Filter Sidebar %>
      <div class="lg:w-72 flex-shrink-0" data-controller="filter-panel">
        <!-- Mobile Filter Toggle -->
        <button class="lg:hidden w-full flex items-center justify-between px-4 py-3 bg-white rounded-xl shadow-sm border border-gray-100 mb-4"
                data-action="click->filter-panel#toggle">
          <span class="flex items-center gap-2 font-medium text-gray-700">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
            </svg>
            Filters
          </span>
          <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </button>

        <div class="hidden lg:block space-y-6" data-filter-panel-target="panel">
          <!-- Filter Card -->
          <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
            <div class="px-5 py-4 border-b border-gray-100 flex items-center justify-between">
              <h3 class="font-bold text-gray-900">Filters</h3>
              <%= link_to products_path, class: "text-sm text-indigo-600 hover:text-indigo-700 font-medium" do %>
                Clear all
              <% end %>
            </div>

            <!-- Categories -->
            <div class="px-5 py-4 border-b border-gray-100">
              <h4 class="text-sm font-semibold text-gray-900 mb-3">Categories</h4>
              <div class="space-y-2 max-h-48 overflow-y-auto">
                <% Category.where(visible: true).each do |category| %>
                  <label class="flex items-center gap-3 cursor-pointer group">
                    <%= check_box_tag "category_ids[]", category.id,
                        params[:category_ids]&.include?(category.id.to_s),
                        id: "category-#{category.id}",
                        class: "w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500",
                        data: { action: "change->filter-panel#submit" } %>
                    <span class="text-sm text-gray-600 group-hover:text-gray-900 transition-colors flex-1">
                      <%= category.name %>
                    </span>
                    <span class="text-xs text-gray-400 bg-gray-100 px-2 py-0.5 rounded-full">
                      <%= category.products_count %>
                    </span>
                  </label>
                <% end %>
              </div>
            </div>

            <!-- Price Range -->
            <div class="px-5 py-4 border-b border-gray-100"
                 data-controller="price-range"
                 data-price-range-min-value="0"
                 data-price-range-max-value="1000"
                 data-price-range-current-min-value="<%= params[:min_price] || 0 %>"
                 data-price-range-current-max-value="<%= params[:max_price] || 1000 %>">
              <h4 class="text-sm font-semibold text-gray-900 mb-3">Price Range</h4>
              <div class="flex items-center gap-2 mb-4">
                <div class="flex-1 relative">
                  <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm">$</span>
                  <input type="number" placeholder="Min" value="<%= params[:min_price] %>"
                         class="w-full pl-7 pr-3 py-2 text-sm border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                         data-price-range-target="minInput"
                         data-action="change->filter-panel#submit">
                </div>
                <span class="text-gray-400">â€“</span>
                <div class="flex-1 relative">
                  <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm">$</span>
                  <input type="number" placeholder="Max" value="<%= params[:max_price] %>"
                         class="w-full pl-7 pr-3 py-2 text-sm border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                         data-price-range-target="maxInput"
                         data-action="change->filter-panel#submit">
                </div>
              </div>
              <input type="hidden" name="min_price" data-price-range-target="minHiddenInput">
              <input type="hidden" name="max_price" data-price-range-target="maxHiddenInput">
            </div>

            <!-- Product Type -->
            <div class="px-5 py-4">
              <h4 class="text-sm font-semibold text-gray-900 mb-3">Product Type</h4>
              <div class="space-y-3">
                <label class="flex items-center gap-3 cursor-pointer group">
                  <%= check_box_tag "digital", "1", params[:digital] == "1",
                      id: "digital-filter",
                      class: "w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500",
                      data: { action: "change->filter-panel#submit" } %>
                  <span class="text-sm text-gray-600 group-hover:text-gray-900 transition-colors">
                    Digital Products
                  </span>
                </label>
                <label class="flex items-center gap-3 cursor-pointer group">
                  <%= check_box_tag "on_sale", "1", params[:on_sale] == "1",
                      id: "on-sale-filter",
                      class: "w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500",
                      data: { action: "change->filter-panel#submit" } %>
                  <span class="text-sm text-gray-600 group-hover:text-gray-900 transition-colors flex items-center gap-2">
                    On Sale
                    <span class="text-xs bg-red-100 text-red-600 px-1.5 py-0.5 rounded">SALE</span>
                  </span>
                </label>
                <label class="flex items-center gap-3 cursor-pointer group">
                  <%= check_box_tag "featured", "1", params[:featured] == "1",
                      id: "featured-filter",
                      class: "w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500",
                      data: { action: "change->filter-panel#submit" } %>
                  <span class="text-sm text-gray-600 group-hover:text-gray-900 transition-colors flex items-center gap-2">
                    Featured
                    <svg class="w-4 h-4 text-amber-500" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                    </svg>
                  </span>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <%# Products Section %>
      <div class="flex-1 min-w-0">
        <%# Header with Count and Sort %>
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
          <div>
            <h2 class="text-xl font-bold text-gray-900">
              <% if params[:category_id].present? %>
                <%= Category.find_by(id: params[:category_id])&.name || 'Products' %>
              <% else %>
                All Products
              <% end %>
            </h2>
            <p class="text-sm text-gray-500 mt-0.5">
              <%= @products.total_count rescue @products.count %> products found
            </p>
          </div>
          <div class="flex items-center gap-3">
            <div class="relative">
              <select name="sort" id="sort"
                      class="appearance-none bg-white pl-4 pr-10 py-2.5 text-sm border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent cursor-pointer"
                      data-action="change->filter-panel#submit">
                <option value="newest" <%= 'selected' if params[:sort] == 'newest' %>>Newest First</option>
                <option value="price_asc" <%= 'selected' if params[:sort] == 'price_asc' %>>Price: Low to High</option>
                <option value="price_desc" <%= 'selected' if params[:sort] == 'price_desc' %>>Price: High to Low</option>
                <option value="best_selling" <%= 'selected' if params[:sort] == 'best_selling' %>>Best Selling</option>
                <option value="highest_rated" <%= 'selected' if params[:sort] == 'highest_rated' %>>Highest Rated</option>
              </select>
              <svg class="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
              </svg>
            </div>
          </div>
        </div>

        <%# Product Grid %>
        <% if @products.any? %>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            <% @products.each do |product| %>
              <div class="group bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl hover:border-indigo-100 transition-all duration-300">
                <!-- Product Image -->
                <div class="relative aspect-square overflow-hidden bg-gray-100">
                  <% if product.on_sale? %>
                    <div class="absolute top-3 left-3 z-10">
                      <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold bg-red-500 text-white shadow-sm">
                        Sale
                      </span>
                    </div>
                  <% end %>
                  <% if product.is_digital? %>
                    <div class="absolute top-3 right-3 z-10">
                      <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold bg-blue-500 text-white shadow-sm">
                        Digital
                      </span>
                    </div>
                  <% end %>

                  <%= link_to product_path(product), class: "block" do %>
                    <% if product.product_images.any? && product.product_images.first.image.attached? %>
                      <%= image_tag rails_blob_url(product.product_images.first.image), class: "w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" %>
                    <% else %>
                      <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200">
                        <svg class="w-16 h-16 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                      </div>
                    <% end %>
                  <% end %>

                  <!-- Quick Actions Overlay -->
                  <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-all duration-300 flex items-end justify-center pb-4">
                    <div class="flex gap-2">
                      <%= button_to wishlist_items_path(product_id: product.id), method: :post,
                          class: "p-2.5 rounded-full bg-white/90 text-gray-700 hover:text-red-500 hover:bg-white transition-all shadow-lg transform translate-y-4 group-hover:translate-y-0 duration-300",
                          data: { turbo: true } do %>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>
                      <% end %>
                      <%= button_to add_to_cart_product_path(product), method: :post,
                          class: "p-2.5 rounded-full bg-indigo-600 text-white hover:bg-indigo-700 transition-all shadow-lg transform translate-y-4 group-hover:translate-y-0 duration-300 delay-75",
                          data: { turbo: true } do %>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
                        </svg>
                      <% end %>
                      <%= link_to product_path(product),
                          class: "p-2.5 rounded-full bg-white/90 text-gray-700 hover:text-indigo-600 hover:bg-white transition-all shadow-lg transform translate-y-4 group-hover:translate-y-0 duration-300 delay-150" do %>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                        </svg>
                      <% end %>
                    </div>
                  </div>
                </div>

                <!-- Product Details -->
                <div class="p-4">
                  <div class="flex items-start justify-between gap-2 mb-2">
                    <h3 class="font-semibold text-gray-900 group-hover:text-indigo-600 transition-colors line-clamp-1">
                      <%= link_to product.name, product_path(product) %>
                    </h3>
                    <!-- Rating -->
                    <div class="flex items-center gap-1 flex-shrink-0">
                      <svg class="w-4 h-4 text-amber-400" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                      </svg>
                      <span class="text-xs text-gray-500">
                        <% avg_rating = product.reviews.average(:rating).to_f.round(1) rescue 0 %>
                        <%= avg_rating > 0 ? avg_rating : 'New' %>
                      </span>
                    </div>
                  </div>
                  
                  <p class="text-sm text-gray-500 line-clamp-2 mb-3">
                    <%= truncate(product.description, length: 80) %>
                  </p>
                  
                  <div class="flex items-end justify-between pt-3 border-t border-gray-100">
                    <% if product.discounted_price.present? && product.discounted_price < product.price %>
                      <div>
                        <p class="text-lg font-bold text-indigo-600"><%= number_to_currency(product.discounted_price) %></p>
                        <p class="text-xs text-gray-400 line-through"><%= number_to_currency(product.price) %></p>
                      </div>
                    <% else %>
                      <p class="text-lg font-bold text-gray-900"><%= number_to_currency(product.price) %></p>
                    <% end %>
                    
                    <% if product.seller.present? %>
                      <span class="text-xs text-gray-400">by <%= product.seller.store_name.presence || product.seller.user&.email&.split('@')&.first || 'Seller' %></span>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>

          <%# Pagination %>
          <% if @products.respond_to?(:total_pages) && @products.total_pages > 1 %>
            <div class="mt-12 flex justify-center">
              <nav class="flex items-center gap-1" aria-label="Pagination">
                <%= link_to_prev_page @products, '', class: "p-2 rounded-lg border border-gray-200 text-gray-500 hover:bg-gray-50 hover:border-gray-300 transition-colors disabled:opacity-50" do %>
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                  </svg>
                <% end %>
                
                <div class="flex items-center gap-1 mx-2">
                  <% if @products.total_pages <= 7 %>
                    <% (1..@products.total_pages).each do |page| %>
                      <% if page == @products.current_page %>
                        <span class="px-4 py-2 rounded-lg bg-indigo-600 text-white font-medium text-sm"><%= page %></span>
                      <% else %>
                        <%= link_to page, url_for(safe_params_for_pagination.merge(page: page)), class: "px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100 font-medium text-sm transition-colors" %>
                      <% end %>
                    <% end %>
                  <% else %>
                    <% if @products.current_page > 3 %>
                      <%= link_to 1, url_for(safe_params_for_pagination.merge(page: 1)), class: "px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100 font-medium text-sm transition-colors" %>
                      <% if @products.current_page > 4 %>
                        <span class="px-2 text-gray-400">...</span>
                      <% end %>
                    <% end %>
                    <% start_page = [@products.current_page - 1, 1].max %>
                    <% end_page = [@products.current_page + 1, @products.total_pages].min %>
                    <% (start_page..end_page).each do |page| %>
                      <% if page == @products.current_page %>
                        <span class="px-4 py-2 rounded-lg bg-indigo-600 text-white font-medium text-sm"><%= page %></span>
                      <% else %>
                        <%= link_to page, url_for(safe_params_for_pagination.merge(page: page)), class: "px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100 font-medium text-sm transition-colors" %>
                      <% end %>
                    <% end %>
                    <% if @products.current_page < @products.total_pages - 2 %>
                      <% if @products.current_page < @products.total_pages - 3 %>
                        <span class="px-2 text-gray-400">...</span>
                      <% end %>
                      <%= link_to @products.total_pages, url_for(safe_params_for_pagination.merge(page: @products.total_pages)), class: "px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100 font-medium text-sm transition-colors" %>
                    <% end %>
                  <% end %>
                </div>

                <%= link_to_next_page @products, '', class: "p-2 rounded-lg border border-gray-200 text-gray-500 hover:bg-gray-50 hover:border-gray-300 transition-colors disabled:opacity-50" do %>
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                <% end %>
              </nav>
            </div>
          <% end %>
        <% else %>
          <!-- Empty State -->
          <div class="text-center py-16">
            <div class="w-24 h-24 mx-auto mb-6 bg-gray-100 rounded-full flex items-center justify-center">
              <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
              </svg>
            </div>
            <h3 class="text-lg font-semibold text-gray-900 mb-2">No products found</h3>
            <p class="text-gray-500 mb-6">Try adjusting your filters or search criteria</p>
            <%= link_to "Clear Filters", products_path, class: "inline-flex items-center gap-2 px-5 py-2.5 bg-indigo-600 text-white rounded-xl font-medium hover:bg-indigo-700 transition-all" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>